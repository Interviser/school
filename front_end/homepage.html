<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: Arial, sans-serif;
            box-sizing: border-box;
        }
        @media (min-width:768px) {
            #school_logo {
            height: 14%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background-color: purple;
            color: white;
        }
        #school_crest {
            width: 70px;
            height: 70px;
            border-radius: 50%;
        }
        #logout_button {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            border: none;
            background-color: none;
        }
        #for_iframe {
            height: 70%;
            width: 100%;
        }
        #for_nav {
            height: 8%;
            width: 100%;
        }
        nav {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #f0f0f0;
        }
        #annouce, #contact, #test, #history, #timetable {
            width: 18%;
            font-size: 16px;
            cursor: pointer;
            height: 60%;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            border: none;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        button:hover {
            background-color: purple;
            color: white;
        }
        button:active {
            transform: scale(0.98);
        }
        }
        @media (max-width:767px) {
            #school_logo {
                height: 20%;
                width: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                background-color: purple;
                color: white;
                padding: 10px 0;
            }
            #school_crest {
                width: 50px;
                height: 50px;
                border-radius: 50%;
            }
            #logout_button {
                margin-top: 8px;
                padding: 6px 12px;
                font-size: 12px;
                background-color: none;
            }
            #for_iframe {
                height: 65%;
                width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
            }
            #for_nav {
                height: 10%;
                width: 100%;
            }
            nav {
                height: 100%;
                width: 100%;
                display: flex;
                justify-content: space-around;
                align-items: center;
                background-color: #f0f0f0;
            }
            #annouce, #contact, #test, #history, #timetable {
                width: 18%;
                font-size: 14px;
                cursor: pointer;
                height: 60%;
                justify-content: center;
                align-items: center;
                border-radius: 8px;
                border: none;
            }
            iframe {
                width: 100%;
                height: 100%;
                border: none;
            }
            button:hover {
                background-color: purple;
                color: white;
            }
            button:active {
                transform: scale(0.98);
            }
        }
        
    </style>
</head>
<body>
    <section id="school_logo">
        <div>
            <img src="./images/CCIS.jpg" alt="School Logo" loading="lazy" id="school_crest">
            <span>STUDENTS' PORTAL</span>
        </div>
        <div>
            <span id="salutation"></span>
            <button id="logout_button">Logout</button>
        </div>
    </section>
    <section id="for_nav">
        <nav>
            <button id="annouce">Annoucement</button>
            <button id="contact">Contact</button>
            <button id="test">Test</button>
            <button id="history">History</button>
            <button id="timetable">Timetable</button>
            <button id="change_password">Change Password</button>
        </nav>
    </section>
    <section id="for_iframe">
        <iframe src="stu_announcement.html" frameborder="0" id="iframe"></iframe>
    </section>
    <script>
        const iframe = document.getElementById('iframe'); 
        document.getElementById('annouce').addEventListener('click', () => {
            iframe.src = 'http://localhost:3000/stu_announcement.html';
        });
        document.getElementById('contact').addEventListener('click', () => {
            iframe.src = 'http://localhost:3000/contact.html';
        }); 
        document.getElementById('test').addEventListener('click', () => {
            iframe.src = 'http://localhost:3000/test.html';
        });
        document.getElementById('history').addEventListener('click', () => {
            iframe.src = 'http://localhost:3000/history.html';
        });
        document.getElementById('timetable').addEventListener('click', () => {
            iframe.src = 'http://localhost:3000/timetable.html';
        });
        document.getElementById('change_password').addEventListener('click', () => {
            iframe.src = 'http://localhost:3000/changeStuPassword.html';
        });
        
        const verifyUser = async (e)=> {
            e.preventDefault()
            const token = localStorage.getItem('token')
            if(!token){
                return window.location.href = 'http://localhost:3000/login.html'
            }
            
            try { 
                const response = await fetch('http://localhost:3000/api/auth/',{
                    method: 'GET',
                    headers: {
                       'authorization': `Bearer ${token}`
                    }
                })
                if(response.ok){
                     return console.log('successfully logged in')
                }
                else {
                    throw new Error('User not authenticated')}
                           
                }
             catch (err) {
                console.log(err)
                window.location.href = 'http://localhost:3000/login.html'
            }
        
        }
        document.addEventListener('DOMContentLoaded',verifyUser)
        const salutation = document.getElementById('salutation');
        const token = localStorage.getItem('token');
        if (token) {
            const payload = JSON.parse(atob(token.split('.')[1]));
            const firstname = payload.firstName;
            salutation.textContent = `Welcome, ${firstname} ðŸ™Œ`;

        }

        const logoutButton = document.getElementById('logout_button');
        logoutButton.addEventListener('click', () => {
            const confirmLogout = confirm('Are you sure you want to logout?');
            if (!confirmLogout) return;
            localStorage.removeItem('token');
            window.location.href = 'http://localhost:3000/login.html';
        });
        
    </script>
</body>

</html>